var u=Object.defineProperty;var f=(n,e,t)=>e in n?u(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var r=(n,e,t)=>f(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class y{constructor(){r(this,"sounds",new Map);r(this,"muted",!1)}load(e,t){if(this.sounds.has(e))return;const i=new Audio(t);i.preload="auto",this.sounds.set(e,i)}play(e,t={}){const i=this.sounds.get(e);if(!i||this.muted)return;const s=i.cloneNode(!0);s.loop=t.loop??!1,s.volume=t.volume??1,s.play()}setMuted(e){this.muted=e}isMuted(){return this.muted}}const d=1e3/60,m=5;class w{constructor(){r(this,"lastTick",performance.now());r(this,"accumulated",0);r(this,"running",!1);r(this,"subscribers",[]);r(this,"rafId",0);r(this,"loop",()=>{if(!this.running)return;const e=performance.now(),t=e-this.lastTick;this.lastTick=e,this.accumulated+=t;let i=0;for(;this.accumulated>=d&&i<m;)this.accumulated-=d,this.subscribers.forEach(s=>s(d/1e3)),i+=1;this.rafId=requestAnimationFrame(this.loop)})}start(){this.running||(this.running=!0,this.lastTick=performance.now(),this.loop())}stop(){this.running=!1,cancelAnimationFrame(this.rafId)}subscribe(e){return this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);t>=0&&this.subscribers.splice(t,1)}}}class v{constructor(e=window){r(this,"pressedKeys",new Set);r(this,"pointerPosition",{x:0,y:0});r(this,"listeners",[]);r(this,"keyDownListener",e=>this.handleKeyDown(e));r(this,"keyUpListener",e=>this.handleKeyUp(e));r(this,"pointerListener",e=>this.handlePointer(e));r(this,"handleKeyDown",e=>{this.pressedKeys.add(e.key.toLowerCase()),this.listeners.forEach(t=>t(e))});r(this,"handleKeyUp",e=>{this.pressedKeys.delete(e.key.toLowerCase()),this.listeners.forEach(t=>t(e))});r(this,"handlePointer",e=>{this.pointerPosition={x:e.clientX,y:e.clientY},this.listeners.forEach(t=>t(e))});this.target=e}attach(){this.addTargetListeners(this.target)}detach(){this.removeTargetListeners(this.target),this.pressedKeys.clear(),this.listeners=[]}addTargetListeners(e){if(e instanceof Window){e.addEventListener("keydown",this.keyDownListener,{passive:!0}),e.addEventListener("keyup",this.keyUpListener,{passive:!0}),e.addEventListener("pointerdown",this.pointerListener,{passive:!0}),e.addEventListener("pointerup",this.pointerListener,{passive:!0}),e.addEventListener("pointermove",this.pointerListener,{passive:!0});return}e.addEventListener("keydown",this.keyDownListener,{passive:!0}),e.addEventListener("keyup",this.keyUpListener,{passive:!0}),e.addEventListener("pointerdown",this.pointerListener,{passive:!0}),e.addEventListener("pointerup",this.pointerListener,{passive:!0}),e.addEventListener("pointermove",this.pointerListener,{passive:!0})}removeTargetListeners(e){if(e instanceof Window){e.removeEventListener("keydown",this.keyDownListener),e.removeEventListener("keyup",this.keyUpListener),e.removeEventListener("pointerdown",this.pointerListener),e.removeEventListener("pointerup",this.pointerListener),e.removeEventListener("pointermove",this.pointerListener);return}e.removeEventListener("keydown",this.keyDownListener),e.removeEventListener("keyup",this.keyUpListener),e.removeEventListener("pointerdown",this.pointerListener),e.removeEventListener("pointerup",this.pointerListener),e.removeEventListener("pointermove",this.pointerListener)}isKeyPressed(e){return this.pressedKeys.has(e.toLowerCase())}getPointerPosition(){return{...this.pointerPosition}}onInput(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}}class L{constructor(e){r(this,"context");r(this,"canvas");const t=e.getContext("2d");if(!t)throw new Error("Renderer requires 2D canvas context");this.canvas=e,this.context=t,this.context.imageSmoothingEnabled=!0}clear(e="#000000"){const t=this.context;t.save(),t.fillStyle=e,t.fillRect(0,0,this.canvas.width,this.canvas.height),t.restore()}drawSprite(e,t,i){this.context.drawImage(e,t.x,t.y,i.x,i.y)}drawRect(e,t,i){const s=this.context;s.save(),s.fillStyle=i,s.fillRect(e.x,e.y,t.x,t.y),s.restore()}drawText(e,t,i={}){const s=this.context;s.save(),s.fillStyle=i.color??"#ffffff",s.font=i.font??"16px sans-serif",s.textBaseline="top",s.fillText(e,t.x,t.y),s.restore()}resize(e){this.canvas.width=e.x,this.canvas.height=e.y}}class x{constructor(e,t={}){r(this,"audio",new y);r(this,"input");r(this,"renderer");r(this,"ticker",new w);r(this,"currentScene",null);r(this,"elapsedTime",0);r(this,"options");r(this,"update",e=>{var i,s;const t=this.createContext(e);this.options.background?this.renderer.clear(this.options.background):this.renderer.clear(),(i=this.currentScene)==null||i.update(e,t),(s=this.currentScene)==null||s.render(t),this.elapsedTime+=e});this.options=t,this.renderer=new L(e),this.input=new v(window),this.input.attach(),this.ticker.subscribe(this.update)}setScene(e){var t,i;(t=this.currentScene)!=null&&t.onExit&&this.currentScene.onExit(this.createContext()),this.currentScene=e,(i=this.currentScene)!=null&&i.onEnter&&this.currentScene.onEnter(this.createContext())}start(){this.elapsedTime=0,this.ticker.start()}stop(){this.ticker.stop()}dispose(){this.stop(),this.input.detach()}createContext(e=0){return{renderer:this.renderer,input:this.input,elapsedTime:this.elapsedTime+e}}}const a=(n=0,e=0)=>({x:n,y:e}),l=(n,e,t)=>Math.max(e,Math.min(t,n));class E{}class P extends E{constructor(){super(...arguments);r(this,"playerSize",a(48,48));r(this,"playerPosition",a(456,560));r(this,"bullets",[]);r(this,"stars",Array.from({length:64},(t,i)=>({position:a(Math.random()*960,Math.random()*640),speed:40+Math.random()*60+i*.1})));r(this,"shootCooldown",0);r(this,"score",0)}update(t,i){const s=i.input,o=i.renderer.canvas,h=320;(s.isKeyPressed("arrowleft")||s.isKeyPressed("a"))&&(this.playerPosition.x-=h*t),(s.isKeyPressed("arrowright")||s.isKeyPressed("d"))&&(this.playerPosition.x+=h*t),(s.isKeyPressed("arrowup")||s.isKeyPressed("w"))&&(this.playerPosition.y-=h*t),(s.isKeyPressed("arrowdown")||s.isKeyPressed("s"))&&(this.playerPosition.y+=h*t),this.playerPosition.x=l(this.playerPosition.x,0,o.width-this.playerSize.x),this.playerPosition.y=l(this.playerPosition.y,0,o.height-this.playerSize.y),this.shootCooldown-=t,this.shootCooldown<=0&&(s.isKeyPressed(" ")||s.isKeyPressed("space"))&&(this.spawnBullet(),this.shootCooldown=.2),this.updateBullets(t),this.updateStars(t,o.height),this.score+=t*10}render(t){const i=t.renderer;this.stars.forEach(s=>{i.drawRect(s.position,a(2,2),"#e0f7ff")}),this.bullets.forEach(s=>{i.drawRect(s.position,a(6,14),"#ff6f91")}),i.drawRect(this.playerPosition,this.playerSize,"#4dd0e1"),i.drawText("左右/WASD: 移動  Space: ショット",a(24,24),{color:"#f0f4ff",font:"20px/1.4 sans-serif"}),i.drawText(`SCORE: ${Math.floor(this.score).toString().padStart(5,"0")}`,a(24,56),{color:"#ffe082",font:"20px/1.4 monospace"})}spawnBullet(){this.bullets.push({position:a(this.playerPosition.x+this.playerSize.x/2-3,this.playerPosition.y-16),speed:480})}updateBullets(t){this.bullets.forEach(i=>{i.position.y-=i.speed*t}),this.bullets=this.bullets.filter(i=>i.position.y>-20)}updateStars(t,i){this.stars.forEach(s=>{s.position.y+=s.speed*t,s.position.y>i&&(s.position.y=-2,s.position.x=Math.random()*960)})}}const c=document.getElementById("game-canvas");if(!c)throw new Error("キャンバス要素が見つかりません");const p=new x(c,{background:"#05040b"});p.renderer.resize(a(c.width,c.height));p.setScene(new P);p.start();
