var m=Object.defineProperty;var d=s=>{throw TypeError(s)};var u=(s,t,e)=>t in s?m(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>u(s,typeof t!="symbol"?t+"":t,e),O=(s,t,e)=>t.has(s)||d("Cannot "+e);var E=(s,t,e)=>(O(s,t,"read from private field"),e?e.call(s):t.get(s)),l=(s,t,e)=>t.has(s)?d("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),c=(s,t,e,r)=>(O(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var i;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG"})(i||(i={}));const p=(()=>{let s=0;return()=>s++})(),T=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),k=new Error("called FFmpeg.terminate()");var R,D,o,n,I,f,h;class C{constructor(){l(this,R,null);l(this,D,{});l(this,o,{});l(this,n,[]);l(this,I,[]);a(this,"loaded",!1);l(this,f,()=>{E(this,R)&&(E(this,R).onmessage=({data:{id:t,type:e,data:r}})=>{switch(e){case i.LOAD:this.loaded=!0,E(this,D)[t](r);break;case i.EXEC:case i.WRITE_FILE:case i.READ_FILE:case i.DELETE_FILE:case i.RENAME:case i.CREATE_DIR:case i.LIST_DIR:case i.DELETE_DIR:E(this,D)[t](r);break;case i.LOG:E(this,n).forEach(L=>L(r));break;case i.PROGRESS:E(this,I).forEach(L=>L(r));break;case i.ERROR:E(this,o)[t](r);break}delete E(this,D)[t],delete E(this,o)[t]})});l(this,h,({type:t,data:e},r=[])=>E(this,R)?new Promise((L,A)=>{const _=p();E(this,R)&&E(this,R).postMessage({id:_,type:t,data:e},r),E(this,D)[_]=L,E(this,o)[_]=A}):Promise.reject(T));a(this,"load",(t={})=>(E(this,R)||(c(this,R,new Worker(new URL("/dev-sandbox/tools/gifmaker/assets/worker-RjqUVU6j.js",import.meta.url),{type:"module"})),E(this,f).call(this)),E(this,h).call(this,{type:i.LOAD,data:t})));a(this,"exec",(t,e=-1)=>E(this,h).call(this,{type:i.EXEC,data:{args:t,timeout:e}}));a(this,"terminate",()=>{const t=Object.keys(E(this,o));for(const e of t)E(this,o)[e](k),delete E(this,o)[e],delete E(this,D)[e];E(this,R)&&(E(this,R).terminate(),c(this,R,null),this.loaded=!1)});a(this,"writeFile",(t,e)=>{const r=[];return e instanceof Uint8Array&&r.push(e.buffer),E(this,h).call(this,{type:i.WRITE_FILE,data:{path:t,data:e}},r)});a(this,"readFile",(t,e="binary")=>E(this,h).call(this,{type:i.READ_FILE,data:{path:t,encoding:e}}));a(this,"deleteFile",t=>E(this,h).call(this,{type:i.DELETE_FILE,data:{path:t}}));a(this,"rename",(t,e)=>E(this,h).call(this,{type:i.RENAME,data:{oldPath:t,newPath:e}}));a(this,"createDir",t=>E(this,h).call(this,{type:i.CREATE_DIR,data:{path:t}}));a(this,"listDir",t=>E(this,h).call(this,{type:i.LIST_DIR,data:{path:t}}));a(this,"deleteDir",t=>E(this,h).call(this,{type:i.DELETE_DIR,data:{path:t}}))}on(t,e){t==="log"?E(this,n).push(e):t==="progress"&&E(this,I).push(e)}off(t,e){t==="log"?c(this,n,E(this,n).filter(r=>r!==e)):t==="progress"&&c(this,I,E(this,I).filter(r=>r!==e))}}R=new WeakMap,D=new WeakMap,o=new WeakMap,n=new WeakMap,I=new WeakMap,f=new WeakMap,h=new WeakMap;export{C as FFmpeg};
