# Codex ツール企画・仕様書

**名称:** 週刊誌のサムネイル生成
**開発環境:** Vite + TypeScript（GitHub Pages Action 配信）
**対象:** Codex プロジェクトでの利用を前提としたフロントエンドツール

---

## 1. コンセプト

写真から人物を自動切り抜きし、シルエットとして着色。
その上に縦書きの文字を自由に配置できる、軽量・静的なブラウザツール。

主に SNS グラフィック、イベントビジュアル、ポスター等の制作支援を目的とする。
バックエンドを持たず、**GitHub Pages 上で完結するオフライン対応ツール**を目指
す。

---

## 2. 開発目的

1. **AI 推論をローカルで完結**：MediaPipe の Selfie Segmenter を利用し、サーバー
   不要の人物切り抜きを実現。
2. **クリエイティブ用途に最適化**：文字や色のカスタマイズ、アート的構図の再現。
3. **ワンアクション生成**：画像選択 → 色指定 → テキスト入力 → 即生成 → ダウン
   ロードまでをワンクリックで。

---

## 3. 機能概要

| 機能カテゴリ   | 説明                                                     |
| -------------- | -------------------------------------------------------- |
| 画像入力       | ユーザーがローカル画像（PNG/JPG/WebP）をアップロード可能 |
| 人物抽出       | MediaPipe Selfie Segmenter による自動人物切り抜き        |
| シルエット化   | 指定色で人物をベタ塗り処理                               |
| 背景設定       | 透明 / 単色 / 背景画像から選択可能                       |
| 文字入力       | 任意の日本語・英数字を縦書きでレイアウト                 |
| 文字位置調整   | プレビューをクリック / タップして縦書き文字を移動        |
| 文字スタイル   | フォント・色・ストローク幅・影・サイズを調整可能         |
| 出力形式       | PNG（透明または背景込み）をダウンロード                  |
| 自動レイアウト | 縦中央揃え・上下余白・均等文字間隔を自動処理             |

---

## 4. 想定ユーザー

- SNS バナーや投稿画像を作るデザイナー・映像制作者
- アートイベントや展示会で告知画像を量産したいチーム
- Codex 上でメディア生成・編集タスクを自動化する開発者

---

## 5. ユーザーフロー

1. **画像をアップロード**
   - ファイルをドラッグ＆ドロップまたは選択
2. **色と背景を指定**
   - シルエット色、背景色または透明背景を設定
3. **縦書き文字を入力**
   - 例：「大物俳優」などを入力、中央配置が初期値
   - プレビューをクリック / タップすると文字の表示位置を自由に変更可能
4. **出力サイズを設定（任意）**
   - A4相当、SNSプリセットなど選択可能
5. **「生成」ボタンを押下**
   - 画像解析・描画が自動実行されプレビュー表示
6. **「ダウンロード」ボタンで保存**
   - PNG形式で保存（透過含む）

---

## 6. UI 仕様概要

| 要素               | 種類         | 初期値・動作              |
| ------------------ | ------------ | ------------------------- |
| 画像入力           | file input   | 未選択時は無効化          |
| シルエット色       | color picker | `#0E5AFF`                 |
| 背景設定           | select box   | 透明 or 単色              |
| 背景色             | color picker | `#FFFFFF`                 |
| テキスト入力       | text field   | 「大物俳優」              |
| フォントサイズ     | number input | 280px                     |
| ストローク幅       | number input | 8px                       |
| 出力幅／高さ       | number input | 2000×3000                 |
| 生成ボタン         | button       | MediaPipe初期化後に有効化 |
| ダウンロードボタン | anchor       | 出力生成後に表示          |

---

## 7. 処理フロー

1. **画像読込**
   - File API で画像を読み込み、Canvasへ展開。
2. **人物切り抜き**
   - MediaPipe Tasks Vision (Selfie Segmenter) に画像を渡し、人物領域マスクを取
     得。
3. **マスク処理**
   - 背景透明化、または塗り潰し処理を実行。
   - ガンマ補正と近傍平滑化でマスクを滑らかにし、エッジを自然化。
4. **シルエット描画**
   - 非ゼロ領域のバウンディングボックスを抽出し、人物をキャンバス中央へリフレーミング。
   - 塗り色（指定色）で人物領域を描画。
5. **背景合成**
   - 透明／単色／画像を選択して描画。
6. **縦書きテキスト配置**
   - 上→下方向に文字を均等配置。
   - stroke → fill の順で重ね書き。
7. **画像出力**
   - Canvas を PNG 化してダウンロードリンクを生成。

---

## 8. 技術仕様（主要コンポーネント）

| コンポーネント             | 機能概要                                             |
| -------------------------- | ---------------------------------------------------- |
| **MediaPipe Tasks Vision** | WebAssemblyベースの人物セグメンテーションモデル。    |
| SelfieSegmenterを使用。    |
| **Canvas API**             | マスク合成、描画、テキストレンダリングを実行。       |
| **Vite + TypeScript**      | 開発・バンドル環境。ESMでPages対応。                 |
| **GitHub Actions**         | 自動ビルド・Pagesデプロイを行う。Node 20環境で実行。 |

---

## 9. 出力パラメータ仕様

| パラメータ      | 型     | 説明                                |
| --------------- | ------ | ----------------------------------- |
| `image`         | File   | 入力画像                            |
| `fg_color`      | string | シルエット色（HEX）                 |
| `bg_mode`       | enum   | `"transparent"` or `"solid"`        |
| `bg_color`      | string | 背景色（HEX, bg_modeがsolidの時）   |
| `text`          | string | 表示文字列（縦書き）                |
| `font_size`     | number | 文字サイズ(px)                      |
| `stroke_width`  | number | ストローク幅(px)                    |
| `output_width`  | number | 出力幅(px)                          |
| `output_height` | number | 出力高さ(px)                        |
| `export_format` | string | `"png"` 固定（将来的に svg 対応可） |

---

## 10. デザインガイドライン

- シルエット色：`#0E5AFF`（初期値）
- 背景：白または透明
- フォント：Noto Sans JP / Noto Serif JP
- テキスト色：白＋黒ストローク 8px
- 縦書き中央配置、上下余白 15%
- 出力比率：2:3（縦長ポスター想定）

---

## 11. パフォーマンス要件

| 指標               | 目標値             |
| ------------------ | ------------------ |
| 初期ロード         | < 2 秒             |
| セグメンテーション | < 3 秒（2000px級） |
| 描画＆出力         | < 1 秒             |
| 総処理時間         | 5 秒以内           |

---

## 12. GitHub Pages デプロイ方針

- **Actions ワークフロー:**
  main ブランチ push 時に `npm run build` → `dist` を Pages へ自動公開
- **ビルド環境:** Node 20.x
- **公開URL:** `https://<ユーザー名>.github.io/<リポジトリ名>/`
- **vite.config.ts:** base パスをリポジトリ名に対応させる設定必須

---

## 13. 非機能要件

- 完全クライアント処理（画像は外部送信しない）
- プライバシー保護設計（データ保存なし）
- HTTPS 環境下で動作（MediaPipe要求）
- モバイルブラウザ対応（iOS Safari / Android Chrome）
- 画像サイズ制限：最大 6000px / 20MB

---

## 14. 将来的拡張

| 項目               | 内容                             |
| ------------------ | -------------------------------- |
| シルエット外縁強調 | 線幅・ぼかし調整対応             |
| ドロップシャドウ   | 影の方向・透明度を追加           |
| 縦中横処理         | 英数字を自動横配置               |
| 手動マスク修正     | 追加／削除ブラシ機能             |
| テンプレート保存   | 設定をプリセット化し再利用       |
| バッチ生成         | 色・文字バリエーションの自動出力 |

---

## 15. 成果物要件

- ツールを `npm run dev` でローカル起動可能
- `npm run build` により `/dist` 生成
- GitHub Pages で即動作
- 画像アップロードから出力までワンクリック完結

---

## 16. 成果イメージ

| 段階 | 説明 |
| 処理後 | 背景除去 → 指定色で塗りつぶし |
| 最終出力 | シルエット中央に縦書き文字を配置したPNG |

---

## 17. 評価基準（受け入れ条件）

- 背景除去が自然で人物が明確に残ること
- シルエットの塗りが均一で破綻しないこと
- 文字レイアウトが縦書き中央揃えで安定していること
- 出力画像が透過PNGまたは単色背景で保存できること
- GitHub Pages 上で動作（追加サーバー不要）

---

## 18. ライセンスと配布

- MediaPipe は Apache License 2.0
- Noto フォントは SIL Open Font License 現性を持つ軽量ツー
  ルとして実装可能。\*\*
